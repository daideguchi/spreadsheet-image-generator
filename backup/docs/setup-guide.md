# セットアップガイド

## 1. Google スプレッドシートでの設定手順

### ステップ 1: スプレッドシートの準備

1. [Google スプレッドシート](https://sheets.google.com)で新しいシートを作成
2. メニューから `拡張機能` → `Apps Script` を選択

### ステップ 2: スクリプトファイルの設定

**Apps Script エディタの画面構成**:

```
┌─────────────────┬─────────────────────────────┐
│ 左側：ファイル一覧 │    右側：コードエディタ部分      │
│ ┌─────────────┐ │                             │
│ │   + ボタン    │ │                             │
│ ├─────────────┤ │                             │
│ │ 📄 コード.gs  │ │      ここにコードを編集      │
│ │ 📄 Sidebar.html│ │                             │
│ └─────────────┘ │                             │
└─────────────────┴─────────────────────────────┘
```

#### Code.gs の設定

1. Apps Script エディタで、左側のファイル一覧にある **`コード.gs`** ファイルをクリック
2. 右側のエディタに既存のコード（通常は function myFunction() {}）が表示される
3. **既存のコードをすべて削除**
4. 下記の `Code.gs` の内容をすべてコピー＆ペースト

#### Sidebar.html の設定

**重要**: この手順は Apps Script エディタ内で行います

1. **HTML ファイルの作成**
   - Apps Script エディタの左側にあるファイル一覧を確認
   - ファイル一覧の上部にある **「+」ボタン** をクリック
   - 表示されるメニューから **「HTML ファイル」** を選択
2. **ファイル名の設定**

   - 「新しい HTML ファイル」ダイアログが表示される
   - ファイル名欄に **`Sidebar`** と入力（.html 拡張子は自動付与）
   - **「作成」** ボタンをクリック

3. **HTML コードの貼り付け**
   - 左側のファイル一覧で **`Sidebar.html`** をクリック
   - 右側のエディタに既存のテンプレートコードが表示される
   - **既存の内容をすべて削除**
   - 下記の `Sidebar.html` の内容をすべてコピー＆ペースト

**注意**: Google Apps Script では「ファイル」メニューではなく、左側のファイル一覧で「+」ボタンを使用します

### ステップ 3: OpenAI API キーの設定

1. Apps Script エディタで歯車アイコン（プロジェクトの設定）をクリック
2. `スクリプト プロパティ` セクションを見つける
3. `スクリプト プロパティを追加` をクリック
4. 以下を入力：
   - **プロパティ**: `OPENAI_API_KEY`
   - **値**: あなたの OpenAI API キー（sk-proj-から始まる文字列）

### ステップ 4: 権限の許可

1. `実行` ボタンをクリック（関数は `onOpen` を選択）
2. 権限の確認ダイアログが表示されたら `権限を確認` をクリック
3. Google アカウントを選択
4. `詳細` → `無題のプロジェクト（安全ではないページ）に移動` をクリック
5. `許可` をクリック

### ステップ 5: 動作確認

1. スプレッドシートのタブに戻る
2. ページを再読み込み（F5 キー）
3. メニューに `画像ツール` が表示されることを確認

## 2. 使用方法

### 画像生成の手順

1. スプレッドシートのセルにプロンプトを入力
   ```
   例: 「美しい夕日の風景」
   ```
2. プロンプトを入力したセル範囲を選択
3. メニュー `画像ツール` → `サイドバーを開く`
4. サイドバーで `画像を生成` ボタンをクリック
5. 生成された画像がセルに表示されます

### 画像ダウンロードの手順

1. サイドバーで `画像をダウンロード` ボタンをクリック
2. ZIP 形式で全画像がダウンロードされます

## 3. トラブルシューティング

### よくある問題と解決方法

#### 問題: "OpenAI API キーが設定されていません" エラー

**解決方法**:

- スクリプト プロパティの設定を再確認
- API キーが正しく入力されているか確認

#### 問題: "権限が不足しています" エラー

**解決方法**:

- Apps Script エディタで再度権限を許可
- ブラウザの設定でポップアップをブロックしていないか確認

#### 問題: 画像が生成されない

**解決方法**:

- プロンプトが英語または日本語で明確に記述されているか確認
- OpenAI API の利用制限に達していないか確認
- ネットワーク接続を確認

#### 問題: サイドバーが表示されない

**解決方法**:

- `Sidebar.html` ファイルが正しく作成されているか確認
- ブラウザを再読み込み
- 別のブラウザで試す

## 4. 制限事項とコスト

### API 制限

- OpenAI API には利用制限があります
- 大量の画像生成を行う場合は、API 制限に注意してください

### コスト

- DALL-E 3: 約$0.04 per image (1024x1024)
- 生成前に OpenAI のプライシングページで最新料金を確認してください

### パフォーマンス

- 複数画像の同時生成には時間がかかります
- 一度に大量の画像を生成する場合は、分割して実行することをお勧めします

## 5. カスタマイズ

### 画像サイズの変更

`Code.gs` の `generateImages` 関数内で `size` パラメータを変更：

```javascript
size: "512x512"; // または "1792x1024"
```

### 画像品質の変更

```javascript
quality: "hd"; // 高品質（コスト増）
```

### プロンプトの自動改善

DALL-E 3 では、プロンプトが自動的に改善されます。
改善されたプロンプトを確認したい場合は、コンソールログを確認してください。
